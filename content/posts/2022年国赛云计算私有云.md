---
title: "2022年国赛云计算私有云"
subtitle: ""
date: 2023-02-02T13:40:04+08:00
author: "feyncode"
authorLink: "https://github.com/feyncode"
authorEmail: "feyncode@gmail.com"
description: ""
#keywords: ""
#password:
message: 真正的大师永远都怀着一颗学徒的心

weight: 0

tags:
- openstack
categories:
- openstack

# 如果设为true，这篇文章将不会显示在主页上
hiddenFromHomePage: false
#如果设为true，这篇文章将不会显示在搜索结果中
hiddenFromSearch: false

resources:
- name: featured-image
  src: featured-image.jpg
- name: featured-image-preview
  src: featured-image-preview.jpg

toc:
  enable: true
math:
  enable: false
lightgallery: false

repost:
  enable: false
  url: ""

license: "<a rel=\"license external nofollow noopener noreferrer\" href=\"https://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">CC BY-NC 4.0</a>"
comment: true
#{{< admonition note "注意" true>}}
# note注意，tip提示，abstract摘要，info信息，success成功，question问题，warning警告，failure失败，danger危险，bug，example示例，quote引用。
#{{< /admonition >}}
---

<!--more-->

# 2022 年国赛-云计算赛项-私有云

【赛程名称】 云计算赛项第一场-私有云

​	某企业拟使用 OpenStack 搭建一个企业云平台，以实现资源池化弹性管理、企业应用集中管理、统一安全认证和授权等管理。系统架构如图 1 所示，本地环境IP地址规划如表 1 所示。

![image-20221004171314020](https://gitee.com/feyncode/images/raw/master/gitee/image-20221004171314020.png)

​																								图 1 系统架构图

​																								表 1 IP地址规划![image-20221004171443861](https://gitee.com/feyncode/images/raw/master/gitee/image-20221004171443861.png)											

竞赛时会提供三个平台：私有云平台，竞赛系统以及文件服务器

​			竞赛系统用于查题，答题

​			私有云平台用于实例的搭建(如搭建Openstack需要的双节点)

​			文件服务器提供竞赛所需要的所有软件包以及yum仓库等

​	如下为我的本地环境。

| IP地址         | 功能                 |
| -------------- | -------------------- |
| 192.168.100.10 | 控制节点(controller) |
| 192.168.100.20 | 计算节点(compute)    |

> 约定，将IP地址为192.168.100.10的节点记为 `NODE controller` ，将IP地址为192.168.100.20的节点记为 `NODE compute`

## 【任务 1 】 私有云服务搭建 （10分）

### 【题目 1 】 基础环境搭建 （0.5 分）

​		使用提供的用户名密码，登录提供的 OpenStack 私有云平台，在当前租户下，使用 CentOS7.9 镜像，创建两台云主机，云主机类型使用 4vCPU/12G/100G_50G 类型。当前租户 下默认存在一张网卡，自行创建第二张网卡并连接至 controller 和 compute 节点（第二张网 卡的网段为 10.10.X.0/24，X 为工位号，不需要创建路由）。自行检查安全组策略，以确保 网络正常通信与 ssh 连接，然后按以下要求配置服务器： 

（1）设置控制节点主机名为 controller，设置计算节点主机名为 compute； 

（2）修改 hosts 文件将 IP 地址映射为主机名； 

​		完成后提交控制节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
hostnamectl set-hostname controller
# NODE compute
hostnamectl set-hostname compute
# ALL NODE
cat >> /etc/hosts <<EOF
192.168.100.10 controller
192.168.100.20 compute
EOF

<重新远程连接服务器使主机名更改生效>
~~~

### 【题目 2 】 Yum源配置[0.5 分]

​		使用提供的 http 服务地址，在 http 服务下，存在 centos7.9 和 iaas 的网络 yum 源，使用 该 http 源作为安装 iaas 平台的网络源。分别设置 controller 节点和 compute 节点的 yum 源文件 http.repo。

​		完成后提交控制节点的用户名、密码和 IP 地址到答题框。

~~~shell
# ALL NODE
# 删除默认yum源
rm -rf /etc/yum.repos.d/* 
[mv /etc/yum.repos.d/* /media/]
# 构建网络源
cat > /etc/yum.repos.d/http.repo <<EOF
[centos]
name=centos
gpgcheck=0
baseurl=http://192.168.200.10/centos
[iaas]
name=iaas
gpgcheck=0
baseurl=http://192.168.200.10/iaas/iaas-repo
EOF

#可以验证源的配置是否正确
yum repolist
~~~

### 【题目 3 】 配置无秘钥 SSH[0.5 分]

​		配置 controller 节点可以无秘钥访问 compute 节点，配置完成后，尝试 ssh 连接 compute 节点的 hostname 进行测试。

​		完成后提交 controller 节点的用户名、密码和 IP 地址到答题框。

​		这个题目有一个地方需要注意一下，题目说的是配置controller节点可以无秘钥访问compute节点，意思是在controller节点作ssh私钥，然后发公钥给compute节点，这样controller节点可以无秘钥ssh登录compute节点。但是他这个检测，查看控制节点允许计算节点无秘钥登录，所以实际上是检测的是compute节点能不能无秘钥ssh登录controller节点。

​		所以为了在不知道具体判分规则的情况下，建议大家在两个节点上都做一下。

~~~shell
# NODE controller
ssh-keygen 
ssh-copy-id compute #输入yes，输入密码

# NODE compute
ssh-keygen 
ssh-copy-id controller #输入yes，输入密码
~~~

### 【题目 4 】 基础安装[0.5 分]

​		在控制节点和计算节点上分别安装 openstack-iaas 软件包，根据表 2 配置两个节点脚本 文件中的基本变量（配置脚本文件为/etc/openstack/openrc.sh）。

​																				表 2 云平台配置信息

![image-20221004141817588](https://gitee.com/feyncode/images/raw/master/gitee/image-20221004141817588.png)

​				完成后提交控制节点的用户名、密码和 IP 地址到答题框。

​		这个地方是一个花时间比较多的点，然后其实填的内容基本都知道了，那么怎么快速搞定这个文档然后进入到接下来的安装呢。

​		我参照了几位的做法，感觉可能以下这个做法可以在保证准确度的同时兼顾时间的损耗。

~~~shell
#ALL node
yum install openstack-iaas -y

#NODE controller
vi /etc/openstack/openrc.sh

:g@^$@d
:g@##@d
:%s@#@@
:%s@SS=@SS=000000

#根据具体情况配置文件
HOST_IP=192.168.100.10
HOST_PASS=000000
HOST_NAME=controller
HOST_IP_NODE=192.168.100.20
HOST_PASS_NODE=000000
HOST_NAME_NODE=compute
network_segment_IP=192.168.100.0/24
RABBIT_USER=openstack
RABBIT_PASS=000000
DB_PASS=000000
DOMAIN_NAME=demo
ADMIN_PASS=000000
DEMO_PASS=000000
KEYSTONE_DBPASS=000000
GLANCE_DBPASS=000000
GLANCE_PASS=000000
PLACEMENT_DBPASS=000000
PLACEMENT_PASS=000000
NOVA_DBPASS=000000
NOVA_PASS=000000
NEUTRON_DBPASS=000000
NEUTRON_PASS=000000
METADATA_SECRET=000000
INTERFACE_NAME=eth1
Physical_NAME=provider
minvlan=1
maxvlan=2000
CINDER_DBPASS=000000
CINDER_PASS=000000
BLOCK_DISK=sdb1
SWIFT_PASS=000000
OBJECT_DISK=sdb2
STORAGE_LOCAL_NET_IP=192.168.100.20
TROVE_DBPASS=000000
TROVE_PASS=000000
HEAT_DBPASS=000000
HEAT_PASS=000000
CEILOMETER_DBPASS=000000
CEILOMETER_PASS=000000
AODH_DBPASS=000000
AODH_PASS=000000
ZUN_DBPASS=000000
ZUN_PASS=000000
KURYR_PASS=000000
OCTAVIA_DBPASS=000000
OCTAVIA_PASS=000000
MANILA_DBPASS=000000
MANILA_PASS=000000
SHARE_DISK=sdb3
CLOUDKITTY_DBPASS=000000
CLOUDKITTY_PASS=000000
BARBICAN_DBPASS=000000
BARBICAN_PASS=000000

# NODE controller
scp /etc/openstack/openrc.sh compute:/etc/openstack/openrc.sh

# NODE compute

parted /dev/sdb
mklabel gpt
mkpart a 0% 40%
mkpart b 40% 50%
mkpart c 50% 60%
mkpart d 60% 70%

lsblk
NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda               8:0    0   200G  0 disk 
├─sda1            8:1    0     1G  0 part /boot
└─sda2            8:2    0   199G  0 part 
  ├─centos-root 253:0    0 191.1G  0 lvm  /
  └─centos-swap 253:1    0   7.9G  0 lvm  [SWAP]
sdb               8:16   0   100G  0 disk 
├─sdb1            8:17   0    40G  0 part 
├─sdb2            8:18   0    10G  0 part 
├─sdb3            8:19   0    10G  0 part 
└─sdb4            8:20   0    10G  0 part 

#ALL node
iaas-pre-host.sh
~~~

### 【题目 5 】 数据库安装与调优[0.5 分]

​		在 controller 节点上使用 iaas-install-mysql.sh 脚本安装 Mariadb、Memcached、RabbitMQ 等服务。安装服务完毕后，修改/etc/my.cnf 文件，完成下列要求： 

​		1.设置数据库支持大小写； 

​		2.设置数据库缓存 innodb 表的索引，数据，插入数据时的缓冲为 4G； 

​		3.设置数据库的 log buffer 为 64MB； 

​		4.设置数据库的 redo log 大小为 256MB；

~~~shell
# NODE controller
iaas-install-mysql.sh

cat >>/etc/my.cnf<<EOF
lower_case_table_names = 1
innodb_buffer_pool_size = 4G
innodb_log_buffer_size = 64MB
innodb_log_file_size = 256MB
innodb_log_files_in_group = 2
EOF
systemctl restart mariadb
~~~

### 【题目 6 】Keystone 服务安装与使用[0.5 分]

​		在 controller 节点上使用 iaas-install-keystone.sh 脚本安装 Keystone 服务。安装完成后， 使用相关命令，创建用户 chinaskill，密码为 000000。完成后提交控制节点的用户名、密码 和 IP 地址到答题框。

~~~shell
# NODE controller

iaas-install-keystone.sh

openstack user create chinaskill --password 000000 
~~~

### 【题目 7 】 Glance 安装与使用[0.5 分]

​		在 controller 节点上使用 iaas-install-glance.sh 脚本安装 glance 服务。使用命令将提供 的 cirros-0.3.4-x86_64-disk.img 镜像（该镜像在 HTTP 服务中，可自行下载）上传至平台， 命名为 cirros，并设置最小启动需要的硬盘为 10G，最小启动需要的内存为 1G。完成后提交 控制节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller

iaas-install-glance.sh

openstack image create cirros --file cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare --public --min-disk 10 --min-ram 1024
~~~

### 【题目 8 】 Nova 安装与优化[0.5 分]

​		在 controller 节点和 compute 节点上分别使用 iaas-install-placement.sh 脚本、 iaas-install-nova -controller.sh 脚本、iaas-install-nova-compute.sh 脚本安装 Nova 服务。安装完 成后，请修改 nova 相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不 到 IP 地址而报错失败的问题。配置完成后提交 controller 点的用户名、密码和 IP 地址到答 题框。

~~~shell
# NODE controller

iaas-install-placement.sh
iaas-install-nova-controller.sh

# NODE compute

iaas-install-nova-compute.sh

# NODE controller
sed -i '95avif_plugging_is_fatal=false' /etc/nova/nova.conf
systemctl restart openstack-nova*
~~~

### 【题目 9 】 Neutron 安装[0.5 分]

​		使用提供的脚本 iaas-install-neutron-controller.sh 和 iaas-install-neutron-compute.sh，在 controller 和 compute 节点上安装 neutron 服务。完成后提交控制节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
iaas-install-neutron-controller.sh

# NODE compute
iaas-install-neutron-compute.sh
~~~

### 【题目 10 】 Dashboard 安装[0.5 分]

​		在controller节点上使用iaas-install-dashboad.sh脚本安装dashboad服务。安装完成后， 将 Dashboard 中的 Djingo 数据修改为存储在文件中（此种修改解决了 ALL-in-one 快照在其 他云平台 Dashboard 不能访问的问题）。完成后提交控制节点的用户名、密码和 IP 地址到 答题框。

~~~shell
# NODE controller
iaas-install-dashboard.sh

sed -i 's/backends.cache/backends.file/' /etc/openstack-dashboard/local_settings 
systemctl restart httpd memcached
~~~

### 【题目 11 】 Swift 安装[0.5 分]

​		在 控 制 节 点 和 计 算 节 点 上 分 别 使 用 iaas-install-swift-controller.sh 和 iaas-install-swift-compute.sh 脚本安装 Swift 服务。安装完成后，使用命令创建一个名叫 examcontainer 的容器，将 cirros-0.3.4-x86_64-disk.img 镜像上传到 examcontainer 容器中，并 设置分段存放，每一段大小为 10M。完成后提交控制节点的用户名、密码和 IP 地址到答题 框。

~~~shell
# NODE controller

iaas-install-swift-controller.sh

# NODE compute
iaas-install-swift-compute.sh

openstack container create examcontainer
swift upload -S 10M examcontainer cirros-0.3.4-x86_64-disk.img 
~~~

### 【题目 12 】 Cinder 创建硬盘[0.5 分]

​		在 控 制 节 点 和 计 算 节 点 分 别 使 用 iaas-install-cinder-controller.sh 、 iaas-install-cinder-compute.sh 脚本安装 Cinder 服务，请在计算节点，对块存储进行扩容操作， 即在计算节点再分出一个 5G 的分区，加入到 cinder 块存储的后端存储中去。完成后提交计 算节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
iaas-install-cinder-controller.sh

# NODE compute
iaas-install-cinder-compute.sh

pvcreate /dev/sdb4
vgextend cinder-volumes /dev/sdb4
~~~

### 【题目 13 】 Manila服务安装与使用[0.5 分]

​		在 控 制 和 计 算 节 点 上 分 别 使 用 iaas-install-manila-controller.sh 和 iaas-install-manila-compute.sh 脚本安装 manila 服务。安装服务后创建 default_share_type 共享 类型（不使用驱动程序支持），接着创建一个大小为 2G 的共享存储名为 share01 并开放 share01 目录对 OpenStack 管理网段使用权限。最后提交控制节点的用户名、密码和 IP 地址 到答题框。

~~~shell
# NODE controller
iaas-install-manila-controller.sh

# NODE compute
iaas-install-manila-compute.sh

manila type-create default_share_type false
manila create NFS 2 --name share01
manila access-allow share01 ip 192.168.10.0/24 --access-level rw
~~~

### 【题目 14 】 Barbican 服务安装与使用[0.5 分]

​		使用 iaas-install-barbican.sh 脚本安装 barbican 服务，安装服务完毕后，使用 openstack 命令创建一个名为 secret01 的密钥，创建完成后提交控制节点的用户名、密码和 IP 地址到 答题框。

~~~shell
# NODE controller
iaas-install-barbican.sh

openstack secret store --name secret01 --payload test
~~~

### 【题目 15 】 Cloudkitty 服务安装与使用[1 分]

​		使用 iaas-install-cloudkitty.sh 脚本安装 cloudkitty 服务，安装完毕后，启用 hashmap 评级 模块，接着创建 volume_thresholds 组，创建服务匹配规则 volume.size，并设置每 GB 的价 格为 0.01。接下来对应大量数据设置应用折扣，在组 volume_thresholds 中创建阈值，设置 若超过 50GB 的阈值，应用 2%的折扣（0.98）。设置完成后提交控制节点的用户名、密码 和 IP 地址到答题框。

~~~shell
# NODE controller
iaas-install-cloudkitty.sh

openstack rating modules enable hashmap
openstack rating hashmap group create volume_thresholds
openstack rating hashmap service create volume.size
openstack rating hashmap mapping create -s servicelist -g grouplist -t flat  0.01
openstack rating hashmap threshold create -s servicelist -g grouplist -t rate  50 0.98
~~~

### 【题目 16 】 Openstack平台内存优化[0.5 分]

​		搭建完 OpenStack 平台后，关闭系统的内存共享，打开透明大页。完成后提交控制节点 的用户名、密码和 IP 地址到答题框。

~~~bash
# NODE controller
echo 'never' >> /sys/kernel/mm/transparent_hugepage/defrag
~~~

### 【题目 17 】 修改文件句柄数[0.5 分]

​		Linux 服务器大并发时，往往需要预先调优 Linux 参数。默认情况下，Linux 最大文件 句柄数为 1024 个。当你的服务器在大并发达到极限时，就会报出“too many open files”。 创建一台云主机，修改相关配置，将控制节点的最大文件句柄数永久修改为 65535。配置完 成后提交 controller 点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
cat >> /etc/security/limits.conf <<EOF
* soft nofile 65535
* hard nofile 65535
EOF
~~~

### 【题目 18 】Linux 系统调优-防止 SYN 攻击[1 分]

​		修改 controller 节点的相关配置文件，开启 SYN cookie，防止 SYN 洪水攻击。完成后 提交 controller 节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
echo "net.ipv4.tcp_syncookies = 1" >> /etc/sysctl.conf
sysctl -p
~~~

## 【任务 2】私有云服务运维[10 分]

### 【题目 1】OpenStack 开放镜像权限[0.5 分]

​		使 用 OpenStack 私 有 云 平 台 ， 在 OpenStack 平台的 admin 项 目 中 使 用 cirros-0.3.4-x86_64-disk.img 镜像文件创建名为 glance-cirros 的镜像，通过 OpenStack 命令将 glance-cirros 镜像指定 demo 项目进行共享使用。配置完成后提交 controller 点的用户名、密 码和 IP 地址到答题框。

~~~shell
# NODE controller
#demo admin
openstack image create glance-cirros --file cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare --shared
openstack image add project glance-cirros demo
glance  member-update image-id member-id accepted
~~~

### 【题目 2】OpenStack 消息队列调优[0.5 分]

​		OpenStack 各服务内部通信都是通过 RPC 来交互，各 agent 都需要去连接 RabbitMQ； 随着各服务 agent 增多，MQ 的连接数会随之增多，最终可能会到达上限，成为瓶颈。使用 自行搭建的OpenStack私有云平台，分别通过用户级别、系统级别、配置文件来设置RabbitMQ 服务的最大连接数为 10240，配置完成后提交修改节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller

# 用户级别
cat <<EOF>>/etc/sysctl.conf
fs.file-max = 10240
EOF
# 系统级别
cat <<EOF>>/etc/security/limits.conf
openstack soft	nofile 10240
openstack hard  nofile 10240
EOF
# 配置文件
vi /usr/lib/systemd/system/rabbitmq-server
# 在[Service]下添加
LimitNOFILE=10240

systemctl restart rabbitmq-server
~~~

### 【题目 3】OpenStack Glance 镜像压缩[0.5 分]

​		使用自行搭建的 OpenStack 平台。在 HTTP 服务中存在一个镜像为 CentOS7.5-compress.qcow2 的镜像，请使用 qemu 相关命令，对该镜像进行压缩，压缩后的 镜像命名为 chinaskill-js-compress.qcow2 并存放在/root 目录下。完成后提交 controller 点的用 户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
qemu-img convert -c -q -O qcow2 CentOS7.5-compress.qcow2 chinaskill-js-compress.qcow2
~~~

### 【题目 4】glance 对接 cinder 后端存储[0.5 分]

​		在自行搭建的 OpenStack平台中修改相关参数，使 glance 可以使用 cinder作为后端存储， 将镜像存储于 cinder 卷中。使用 cirros-0.3.4-x86_64-disk.img 文件创建 cirros-image 镜像存储 于 cirros-cinder 卷中，通过 cirros-image 镜像使用 cinder 卷启动盘的方式进行创建虚拟机。 完成后提交修改节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller

# 修改glance-api.conf，在行3350
stores=file,http,cinder
[default_store=cinder]

# 修改cinder.conf
allowed_direct_url_schemes = cinder
image_upload_use_internal_tenant=True

systemctl restart openstack-cinder* openstack-glance*
openstack image create cirros-image --file cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare --public 
openstack volume create cirros-cinder --image cirros-image --size 1
openstack server create cirros --volume cirros-cinder --network eth0 --flavor 2
~~~

### 【题目 5】OpenStack Heat 运维：创建容器[0.5 分]

​		在自行搭建的 OpenStack 私 有 云 平 台 上 ， 在 /root 目录下编写 Heat 模 板 create_container.yaml，要求执行 yaml 文件可以创建名为 heat-swift 的容器。完成后提交控制 节点的用户名、密码和 IP 地址到答题框。（在提交信息前请准备好 yaml 模板执行的环境）

~~~shell
# NODE controller

iaas-install-heat.sh

cat <<EOF>> create_container.yaml
heat_template_version: '2016-10-14'
description: Initial template of SwiftContainer
resources:
  SwiftContainer:
    properties:
      name: heat-swift
    type: OS::Swift::Container
EOF
openstack stack create -f yaml -t create_container.yaml create_container
~~~

### 【题目 6】OpenStack Nova 清除缓存[0.5 分]

​		在 OpenStack 平台的一台计算节点创建虚拟机，若是第一次在该节点创建次虚拟机，会 先将镜像文件复制到该计算节点目录/var/lib/nova/instances/_base。长期下来，该目录会占用 比较大的磁盘空间而要清理。可以通过修改 nova 的配置文件来自动清理该缓存目录，即在 该节点没有使用某镜像启动的云主机，那么这个镜像在过一定的时间后会被自动删除。配置 完成后提交改动节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE controller
sed -i '145 aremove_unused_base_images=true' /etc/nova/nova.conf
systemctl restart openstack-nova*
~~~

### 【题目 7】Redis 一主二从三哨兵模式[1 分]

​		使用提供的 OpenStack 私有云平台，申请三台 CentOS7.9 系统的云主机，使用提供的 http 源，在三个节点自行安装 Redis 服务并启动，配置 Redis 的访问需要密码，密码设置为 123456。然后将这三个 Redis 节点配置为 Redis 的一主二从三哨兵架构，即一个 Redis 主节 点，两个从节点，三个节点均为哨兵节点。配置完成后提交 Redis 主节点的用户名、密码和 IP 地址到答题框。

~~~shell
# *录有视频
#tail -3 /etc/hosts
192.168.200.161 node1 #主 哨兵 
192.168.200.162 node2 #从 哨兵 
192.168.200.163 node3 #从 哨兵

#ALL nodes
yum install redis -y

#node1
/etc/redis.conf
bind 0.0.0.0
requirepass 123456
protected-mode no

#node2,node3
/etc/redis.conf
bind 0.0.0.0
slaveof node1 6379
masterauth 123456
protected-mode no

#ALL nodes
/etc/redis-sentinel.conf
bind 0.0.0.0
sentinel monitor mymaster node1 6379 2
sentinel auth-pass mymaster 123456

systemctl enable --now redis*

#查看
redis-cli 
info replication
~~~

### 【题目 8】Redis 服务调优-AOF[1 分]

​		使用上一题安装的 Redis 服务。在 Redis 中，AOF 配置为以三种不同的方式在磁盘上执 行 write 或者 fsync。假设当前 Redis 压力过大，请配置 Redis 不执行 fsync。除此之外，避免 AOF 文件过大，Redis 会进行 AOF 重写，生成缩小的 AOF 文件。请修改配置，让 AOF 重 写时，不进行 fsync 操作。配置完成后提交 Redis 节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE redis
sed -i 's/appendfsync everysec/appendfsync no/g' /etc/redis.conf
sed -i 's/no-appendfsync-on-rewrite yes/no-appendfsync-on-rewrite no/g' /etc/redis.conf
[systemctl restart redis]
~~~

### 【题目 9】应用部署：堡垒机部署[0.5 分]

​		使用提供的 OpenStack 平台申请一台 CentOS7.9 的云主机，使用提供的软件包安装 JumpServer 堡垒机服务，并配置使用该堡垒机对接自己安装的 controller 和 compute 节点。 完成后提交 JumpServer 节点的用户名、密码和 IP 地址到答题框。

~~~markdown
# *录有视频
# 文档
~~~

### 【题目 10】skywalking 服务部署与应用[1 分]

​		使用提供的 OpenStack 私有云平台，申请一台 centos7.9 系统的云主机，使用提供的软 件包安装 Elasticsearch 服务和 skywalking 服务，将 skywalking 的 UI 访问端口修改为 8888。 接下来再申请一台CentOS7.9的云主机，用于搭建gpmall商城应用，并配置SkyWalking Agent， 将 gpmall 的 jar 包放置探针并启动。安装与配置完成后提交 skywalking 节点的用户名、密码 和 IP 地址到答题框。

~~~markdown
# *录有视频
# 文档另附
~~~

### 【题目 11】Linux 内核优化[1 分]

​		在使用 Linux 服务器的时候，TCP 协议规定，对于已经建立的连接，网络双方要进行四 次挥手才能成功断开连接，如果缺少了其中某个步骤，将会使连接处于假死状态，连接本身 占用的资源不会被释放。因为服务器程序要同时管理大量连接，所以很有必要保证无用的连 接完全断开，否则大量僵死的连接会浪费许多服务器资源。创建一台 CentOS7.9 云主机，修 改相应的配置文件，分别开启 SYN Cookies；允许将 TIME-WAIT sockets 重新用于新的 TCP 连接；开启 TCP 连接中 TIME-WAIT sockets 的快速回收；修改系統默认的 TIMEOUT 时间 为 30。完成后提交修改节点的用户名、密码和 IP 地址到答题框。

~~~shell
# NODE node1
cat <<EOF>>/etc/sysctl.conf
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_fin_timeout = 30
EOF
sysctl -p
~~~

### 【题目 12】排错：Glance 服务排错[1 分]

​		使用赛项提供的 chinaskill-error1 镜像启动云主机，flavor 使用 4vcpu/12G 内存/100G 硬 盘。启动后存在错误的私有云平台，错误现象为查看不到 image 列表，试根据错误信息排查 云平台错误，使云平台可以查询到 image 信息。完成后提交云主机节点的用户名、密码和 IP 地址到答题框。

~~~markdown
# 镜像缺失
# *glance分析讲解
~~~

### 【题目 13】排错：数据库排错[1.5 分]

​		使用赛项提供的排错镜像 chinaskill-error2 创建一台云主机（云主机的登录用户名为 root， 密码为 000000），该云主机中存在错误的数据库服务，错误现象为数据库服务无法启动。 请将数据库服务修复并启动，将数据库的密码修改为 chinaskill123。修复完成后提交该云主 机的用户名、密码和 IP 地址到答题框。

~~~bash
#controller node
/etc/my.cnf
 [mysqld]
skip-grant-tables

systemctl restart mariadb
mysql -uroot
use mysql;
update user set password=password ('chinaskill') where user ='root';
flush privileges;
~~~

## 【任务 3】私有云运维开发[10 分]

### 【题目 1】Ansible 服务部署：部署 MariaDB 集群[2 分]

​		使用 OpenStack 私有云平台，创建 4 台系统为 centos7.9 的云主机，其中一台作为 Ansible 的母机并命名为 ansible，另外三台云主机命名为 node1、node2、node3；使用这一台母机， 编写 Ansible 脚本（在/root 目录下创建 example 目录作为 Ansible 工作目录，部署的入口文 件 命 名 为 cscc_install.yaml ） ， 对 其 他 三 台 云 主 机 进 行 安 装 高 可 用 数 据 库 集 群 （MariaDB_Galera_cluster，数据库密码设置为 123456）的操作（所需的安装包在 HTTP 服 务中）。完成后提交 Ansible 节点的用户名、密码和 IP 地址到答题框。（考试系统会连接到 你的 Ansible 节点，去执行 Ansible 脚本，请准备好 Ansible 运行环境，以便考试系统访问）

~~~markdown
# *录有视频
# *文档另附
~~~

### 【题目 2】Ansible 服务部署：部署 ELK 集群服务[2 分]

​		使用赛项提供的 OpenStack 私有云平台，创建三台 CentOS7.9 系统的云主机分别命名为 elk-1、elk-2 和 elk-3，Ansible 主机可以使用上一题的环境。要求 Ansible 节点编写剧本，执 行 Ansible 剧本可以在这三个节点部署 ELK 集群服务（在/root 目录下创建 install_elk 目录作 为 ansible 工作目录，部署的入口文件命名为 install_elk.yaml）。具体要求为三个节点均安装 Elasticserach 服务并配置为 Elasticserach 集群；kibana 安装在第一个节点；Logstash 安装在 第二个节点。（需要用到的软件包在 HTTP 服务下）完成后提交 ansible 节点的用户名、密 码和 IP 地址到答题框。（考试系统会连接到 ansible 节点，执行 ansible 脚本，准备好环境， 以便考试系统访问）

~~~markdown
# *录有视频
# *文档另附
~~~

### 【题目 3】Python 运维开发：基于 OpenStack Restful API 实现镜像上传[1 分]

​		使用 OpenStack all-in-one 镜像，创建 OpenStack Python 运维开发环境。云主机的用户/ 密码为：“root/Abc@1234”，OpenStack 的域名/账号/密码为：“demo/admin/000000”。 

​		提示说明：python 脚本文件头建议加入“#encoding:utf-8”避免编码错误；测试脚本代 码用 python3 命令执行与测试。 

​		在 controller 节点的/root 目录下创建 api_image_manager.py 脚本，编写 python 代码对接 OpenStack API，完成镜像的创建与上传。创建之前查询是否存在“同名镜像”，如果存在 先删除该镜像。 

​		（1）创建镜像：要求在 OpenStack 私有云平台中上传镜像 cirros-0.3.4-x86_64-disk.img， 名字为 cirros001，disk_format 为 qcow2，container_format 为 bare。 

​		（2）查询镜像：查询 cirros001 的详细信息，并以 json 格式文本输出到控制台。 

​		完成后提交 OpenStack Python 运维开发环境 Controller 节点的 IP 地址，用户名和密码提 交。

~~~markdown
# *录有视频
# *文档另附
~~~

### 【题目 4】Python 运维开发：基于 Openstack Python SDK 实现云主机创建[1 分]

​		使 用 已 建 好 的 OpenStack Python 运 维 开 发 环 境 ， 在 /root 目 录 下 创 建 sdk_server_manager.py 脚本，使用 python-openstacksdk Python 模块，完成云主机的创建和查 询。创建之前查询是否存在“同名云主机”，如果存在先删除该镜像。 

​		（1）创建 1 台云主机：云主机信息如下： 

​		云主机名称如下：server001 

​		镜像文件：cirros-0.3.4-x86_64-disk.img 

​		云主机类型：m1.tiny 

​		网络等必要信息自己补充。 

​		（2）查询云主机：查询云主机 server001 的详细信息，并以 json 格式文本输出到控制 台。 

​		完成后提交 OpenStack Python 运维开发环境 Controller 节点的 IP 地址，用户名和密码 提交。

~~~markdown
# *录有视频
# *文档另附
~~~

### 【题目 5】Python 运维开发：云主机类型管理的命令行工具开发[2 分]

​		使用已建好的 OpenStack Python 运维开发环境，在/root 目录下创建 flavor_manager.py 脚本，完成云主机类型的管理，flavor_manager.py 程序支持命令行参数执行。 

​		提示说明：Python 标准库 argparse 模块，可以提供命令行参数的解析。 

​		要求如下： 

​		（1）程序支持根据命令行参数，创建 1 个多云主机类型。返回 response。 

​		位置参数“create”，表示创建； 

​		参数“-n”支持指定 flavor 名称，数据类型为字符串类型； 

​		参数“-m”支持指定内存大小，数据类型为 int，单位 M； 

​		参数“-v”支持指定虚拟 cpu 个数，数据类型为 int； 

​		参数“-d”支持磁盘大小，内存大小类型为 int，单位 G； 

​		参数“-id”支持指定 ID，类型为字符串。 

​		参考运行实例： 

​		python3 flavor_manager.py create -n flavor_small -m 1024 -v 1 -d 10 -id 100000 

​		（2）程序支持查询目前 admin 账号下所有的云主机类型。 

​		位置参数“getall”，表示查询所有云主机类型； 

​		查询结果，以 json 格式输出到控制台。 

​		参考执行实例如下： 

​		python3 flavor_manager.py getall 

​		（3）支持查询给定具体名称的云主机类型查询。 

​		位置参数“get”，表示查询 1 个云主机类型； 	

​		参数“-id”支持指定 ID 查询，类型为 string。 

​		控制台以 json 格式输出创建结果。 

​		参考执行实例如下： 

​		python3 flavor_manager.py get -id 100000 

​		（4）支持删除指定的 ID 云主机类型。 

​		位置参数“delete”，表示删除一个云主机类型； 

​		参数“-id”支持指定 ID 查询，返回 response，控制台输出 response。 

​		参考执行实例如下： 

​		python3 flavor_manager.py delete -id 100001

~~~markdown
# *录有视频
# *文档另附
~~~

### 【题目 6】Python 运维开发：用户管理的命令行工具开发[2 分]

​		使用已建好的 OpenStack Python 运维开发环境，在/root 目录下创建 user_manager.py 脚 本，完成用户管理功能开发，user_manager.py 程序支持命令行带参数执行。 

​		提示说明：Python 标准库 argparse 模块，可以提供命令行参数的解析。 

​		（1）程序支持根据命令行参数，创建 1 个用户。 

​		位置参数“create”，表示创建； 

​		参数“-i 或--input”，格式为 json 格式文本用户数据。 

​		查询结果，以 json 格式输出到控制台。 

​		参考执行实例如下： 

​		python3 user_manager.py create --input '{ "name": "user01", "password": "000000",  "description": "description" } ' 

​		（2）支持查询给定具体名称的用户查询。 

​		位置参数“get”，表示查询 1 个用户； 

​		参数“-n 或 --name”支持指定名称查询，类型为 string。 

​		参数“-o 或 output”支持查询该用户信息输出到文件，格式为 json 格式。 

​		参考执行实例如下： 

​		python3 user_manager.py get --name user01-o user.json 

​		（3）程序支持查询目前 admin 账号下所有的用户。 

​		位置参数“getall”，表示查询所有用户； 

​		参数“-o 或--output”支持输出到文件，格式为 yaml 格式。 

​		参考执行实例如下： 

​		python3 user_manager.py getall -o openstack_all_user.yaml 

​		（4）支持删除指定的名称的用户。 

​		位置参数“delete”，表示删除一个用户；返回 response，通过控制台输出。 

​		参数“-n 或--name”支持指定名称查询，类型为 string。 

​		参考执行实例如下： 

​		python3 user_manager.py delete -name user01

~~~markdown
# *录有视频
# *文档另附
~~~

